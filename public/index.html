<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rat Fiesta!</title>
    <style>
        body {
            height: 90vh;
            width: 90vw;
            background-color: black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
    <script>
        class Point{
            constructor(x,y,z){
                this.x = x;
                this.y = y;
                this.z = z;
            }
        }

        function rotateX(arr, theta){
            for(var i = 0; i < arr.length; i++){
                var y = arr[i].y;
                var z = arr[i].z;
                arr[i].y = y * Math.cos(theta) - z * Math.sin(theta);
                arr[i].z = z * Math.cos(theta) + y * Math.sin(theta);
            }
        }

        function rotateY(arr, theta){
            for(var i = 0; i < arr.length; i++){
                var x = arr[i].x;
                var z = arr[i].z;
                arr[i].x = x * Math.cos(theta) + z * Math.sin(theta);
                arr[i].z = z * Math.cos(theta) - x * Math.sin(theta);
            }
        }

        function rotateZ(arr, theta){
            for(var i = 0; i < arr.length; i++){
                var y = arr[i].y;
                var x = arr[i].x;
                arr[i].x = x * Math.cos(theta) - y * Math.sin(theta);
                arr[i].y = y * Math.cos(theta) + x * Math.sin(theta);
            }
        }


        let app;
        let arr;
        let sprites;
        let size;
        
        window.onload = function(){
            app = new PIXI.Application(
                {
                    width: 800,
                    height: 600,
                    backgroundColor: 0x000000
                }
            );

            
            
            size = 100;

            arr = [new Point(2*size,0,1*size),
                    new Point(1*size,2*size,0),
                    new Point(0,1*size,2*size),
                    new Point(-2*size,0,1*size),
                    new Point(1*size,-2*size,0),
                    new Point(0,1*size,-2*size),
                    new Point(2*size,0,-1*size),
                    new Point(-1*size,2*size,0),
                    new Point(0,-1*size,2*size),
                    new Point(-2*size,0,-1*size),
                    new Point(-1*size,-2*size,0),
                    new Point(0,-1*size,-2*size),];

            sprites=[]

            //Create Sprites

            for(var i = 0; i < arr.length; i++){
                sprites.push(new PIXI.Sprite.from("images/ratimg.png"));
                sprites[i].anchor.set(0.5);
                sprites[i].x = arr[i].x + (app.view.width / 2);
                sprites[i].y = arr[i].y + (app.view.height / 2);
                sprites[i].scale.x = .2*(Math.abs(arr[i].z - 400)/600);
                sprites[i].scale.y = .2*(Math.abs(arr[i].z - 400)/600);
                app.stage.addChild(sprites[i]);
            }

            
            document.body.onclick = () => {
                document.getElementById("suave").play();
                document.body.appendChild(app.view);
                //Updates every tick
                setTimeout(() => {
                    app.ticker.add(()=>
                        {
                            rotateX(arr, 0.03);
                            rotateY(arr, 0.03);
                            rotateZ(arr, 0.05);
                            for(var i = 0; i < sprites.length; i++){
                            sprites[i].scale.x = .2*(Math.abs(arr[i].z - 400)/600);
                            sprites[i].scale.y = .2*(Math.abs(arr[i].z - 400)/600);
                            sprites[i].x = arr[i].x + (app.view.width / 2);
                            sprites[i].y = arr[i].y + (app.view.height / 2);
                        }
                    })
                }, 15500)
            }

        }
    </script>
</head>
<body>
    <audio id="suave" src="/suavemente" type="audio/mpeg" loop="loop">
</body>
</html>